# Neo4j 知识库管理功能说明

## 功能概述

新增的知识库管理页面提供了对Neo4j图数据库的完整CRUD（增删改查）操作，包括：

- ✅ **节点管理**：查看、创建、编辑、删除节点
- ✅ **关系管理**：查看、创建、编辑、删除关系
- ✅ **标签过滤**：按节点标签和关系类型筛选数据
- ✅ **批量操作**：支持强制删除（同时删除关联关系）

## 访问方式

启动项目后，可以通过以下方式访问管理页面：

1. **直接访问**：http://localhost:3000/admin
2. **导航栏**：在页面顶部点击"知识库管理"按钮

## 功能说明

### 节点管理

#### 查看节点
- 默认显示所有节点（最多100个）
- 可以按标签筛选节点
- 节点卡片显示：ID、标签、所有属性（JSON格式）

#### 创建节点
1. 点击右上角"创建节点"按钮
2. 输入标签（逗号分隔，例如：`Person,Researcher`）
3. 输入属性（JSON格式，例如：`{"name": "张三", "age": 30}`）
4. 点击"创建"按钮

**示例**：
```
标签：Person,Researcher
属性：
{
  "name": "李明",
  "affiliation": "清华大学",
  "email": "liming@tsinghua.edu.cn"
}
```

#### 编辑节点
1. 点击节点卡片上的编辑按钮（铅笔图标）
2. 修改属性（JSON格式）
3. 点击"保存"按钮

**注意**：节点的标签不能修改，只能修改属性。

#### 删除节点
1. 点击节点卡片上的删除按钮（垃圾桶图标）
2. 确认删除操作
3. 系统会自动使用强制删除（DETACH DELETE），同时删除该节点的所有关联关系

### 关系管理

#### 查看关系
- 默认显示所有关系（最多100个）
- 可以按关系类型筛选
- 关系卡片显示：ID、类型、起始节点ID、结束节点ID、属性

#### 创建关系
1. 点击右上角"创建关系"按钮
2. 输入起始节点ID（必填）
3. 输入结束节点ID（必填）
4. 输入关系类型（必填，例如：`KNOWS`、`WORKS_WITH`）
5. 输入属性（可选，JSON格式）
6. 点击"创建"按钮

**示例**：
```
起始节点ID：123
结束节点ID：456
关系类型：RESEARCHES
属性：
{
  "since": "2020",
  "role": "主要研究员"
}
```

**获取节点ID的方法**：
- 在节点管理页面查看节点，每个节点卡片顶部显示ID
- 或者在Neo4j Browser中执行：`MATCH (n) RETURN id(n), n`

#### 编辑关系
1. 点击关系卡片上的编辑按钮（铅笔图标）
2. 修改属性（JSON格式）
3. 点击"保存"按钮

**注意**：关系的类型、起始节点和结束节点不能修改，只能修改属性。

#### 删除关系
1. 点击关系卡片上的删除按钮（垃圾桶图标）
2. 确认删除操作

## 使用技巧

### JSON属性格式

属性必须使用有效的JSON格式：

**正确示例**：
```json
{
  "name": "张三",
  "age": 30,
  "active": true,
  "tags": ["研究员", "教授"]
}
```

**常见错误**：
- ❌ 属性名没有双引号：`{name: "张三"}`
- ❌ 字符串使用单引号：`{"name": '张三'}`
- ❌ 末尾有多余逗号：`{"name": "张三",}`

### 标签命名规范

- 使用大写字母开头的驼峰命名：`Person`, `DrugCompound`
- 多个标签用逗号分隔：`Person,Researcher`
- 避免使用特殊字符和空格

### 关系类型命名规范

- 使用全大写，单词之间用下划线：`RESEARCHES`, `WORKS_WITH`
- 使用动词表示动作：`KNOWS`, `TREATS`, `DEVELOPS`

## API接口

管理功能基于以下RESTful API：

### 节点API (`/api/admin/nodes`)
- `GET` - 查询节点（支持 `label`, `limit`, `skip` 参数）
- `POST` - 创建节点
- `PUT` - 更新节点
- `DELETE` - 删除节点（支持 `detachDelete` 参数）

### 关系API (`/api/admin/relationships`)
- `GET` - 查询关系（支持 `type`, `limit`, `skip` 参数）
- `POST` - 创建关系
- `PUT` - 更新关系
- `DELETE` - 删除关系

### 辅助API
- `GET /api/admin/labels` - 获取所有节点标签
- `GET /api/admin/relationship-types` - 获取所有关系类型

## 注意事项

1. **权限管理**：当前版本没有用户认证，建议在生产环境中添加权限控制
2. **批量操作**：目前每次最多显示100条记录，可以通过API参数调整
3. **数据备份**：在执行删除操作前，建议先备份重要数据
4. **性能考虑**：对于大型图数据库（节点数>10万），建议使用更精确的过滤条件

## 故障排除

### 连接错误
如果遇到"查询失败"错误：
1. 检查Neo4j服务是否运行
2. 确认`.env`文件中的连接配置正确
3. 查看浏览器控制台的详细错误信息

### 创建失败
如果创建节点/关系失败：
1. 检查JSON格式是否正确
2. 对于关系创建，确认起始和结束节点ID存在
3. 检查是否有数据库约束冲突

### 删除失败
如果节点删除失败：
- 系统已自动使用强制删除，如果仍然失败，可能是数据库权限问题

## 原有功能保留

所有原有的自然语言查询功能完全保留：
- ✅ 自然语言查询接口保持不变
- ✅ 图可视化功能不受影响
- ✅ LLM智能回答功能正常工作
- ✅ 通过顶部导航栏可以随时切换功能

---

**技术实现**：
- 前端：Next.js 14 + TypeScript + Tailwind CSS
- UI组件：shadcn/ui
- 数据库：Neo4j (通过 neo4j-driver)
- API：Next.js App Router API Routes

